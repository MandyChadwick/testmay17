This code is refactored from McKay Williams Project 2
